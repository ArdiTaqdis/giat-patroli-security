<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Giat Patroli</title>
    <link rel="stylesheet" href="dashboard.css" />
    <style>
      /* Tambahan untuk status online/offline */
      .status {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.9rem;
        font-weight: 600;
      }
      .status.online {
        background: #4caf50;
        color: #fff;
      }
      .status.offline {
        background: #b71c1c;
        color: #fff;
      }

      /* Progress bar */
      .progress-box {
        width: 100%;
        height: 16px;
        background: #eee;
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #ff7043, #e53935);
        width: 0;
        transition: width 0.4s ease;
      }

      .card-patroli {
        max-width: 400px;
        margin: 20px auto;
        padding: 16px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        text-align: center;
      }

      .patroli-status {
        font-size: 0.9rem;
        color: #444;
      }

      .menu-card.disabled {
        pointer-events: none; /* ‚úÖ tidak bisa diklik */
        opacity: 0.6; /* ‚úÖ tampil lebih redup */
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <input type="hidden" id="nipHidden" />

    <!-- ===== HEADER ===== -->
    <header class="header">
      <div class="profile">
        <img
          id="fotoUser"
          src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
          alt="Foto User"
          class="foto-user"
          onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'"
        />
        <h1 class="app-title">GIAT SCURITY PATROLI</h1>
        <p id="infoUser">
          <span id="namaUser">Nama Security</span> |
          <span id="perusahaan">Perusahaan</span>
        </p>

        <!-- ‚úÖ Greeting personal -->
        <p
          id="greeting"
          style="margin: 5px 0; font-weight: bold; color: #444"
        ></p>

        <span id="statusOnline" class="status offline">Offline</span>
        <div id="dateTime" class="datetime">--/--/---- --:--:--</div>

        <!-- ‚úÖ Tombol Logout -->
      </div>

      <!-- Lengkungan Bawah -->
      <svg
        class="wave"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1440 120"
        preserveAspectRatio="none"
      >
        <path
          fill="#f7f7f7"
          d="M0,64 C360,120 1080,0 1440,80 L1440,0 L0,0 Z"
        ></path>
      </svg>
    </header>

    <!-- Card Patroli -->
    <div class="card-patroli">
      <h2>üìç Patroli Area</h2>
      <div id="patroliProgress" class="progress-box">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <p id="patroliStatus" class="patroli-status">
        0 dari 5 patroli dilakukan.<br />
        <small>‚è≥ Progress akan direset otomatis setiap 12 jam.</small>
      </p>
    </div>

    <main class="menu-container">
      <a href="../pages/form.html" class="menu-card">
        <div class="icon">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
        <p>Absen Patroli</p>
      </a>
      <a href="../pages/pending.html" class="menu-card">
        <div class="icon">‚è≥</div>
        <p>Absen Pending</p>
      </a>
      <a href="../pages/riwayat.html" class="menu-card">
        <div class="icon">üìÖ</div>
        <p>Laporan Patroli</p>
      </a>
      <a href="javascript:void(0)" class="menu-card disabled">
        <div class="icon">üîî</div>
        <p>Notifikasi</p>
        <small style="color: #b71c1c; display: block"
          >Sedang dalam pengembangan</small
        >
      </a>
    </main>

    <button
      onclick="logout()"
      style="
        margin-top: 10px;
        padding: 6px 12px;
        border: none;
        border-radius: 8px;
        background: #b71c1c;
        color: #fff;
        font-weight: bold;
        cursor: pointer;
      "
    >
      üö™ Logout
    </button>
    <footer class="footer">
      <p>&copy; 2025 GIAT PATROLI ‚Ä¢ <span id="tahunSekarang"></span></p>
    </footer>

    <script>
      document.getElementById("tahunSekarang").textContent =
        new Date().getFullYear();
    </script>

    <!-- Jam realtime -->
    <script>
      function updateDateTime() {
        const now = new Date();
        document.getElementById("dateTime").textContent =
          now.toLocaleDateString("id-ID", {
            day: "2-digit",
            month: "long",
            year: "numeric",
          }) +
          " , " +
          now.toLocaleTimeString("id-ID", {
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          });
      }
      setInterval(updateDateTime, 1000);
      updateDateTime();
    </script>

    <!-- Ambil data user -->
    <script>
      const userData = JSON.parse(localStorage.getItem("userData"));
      if (userData) {
        document.getElementById("nipHidden").value = userData.nip;
        document.getElementById("namaUser").textContent = userData.nama;
        document.getElementById("perusahaan").textContent = userData.perusahaan;
        if (userData.foto) {
          document.getElementById("fotoUser").src = userData.foto;
        }

        // ‚úÖ Greeting personal
        document.getElementById("greeting").textContent =
          "üëã Selamat datang, " + userData.nama + "!";
      } else {
        alert("‚ö†Ô∏è Silakan login terlebih dahulu.");
        window.location.href = "../login.html";
      }

      // ‚úÖ Fungsi Logout
      function logout() {
        localStorage.removeItem("userData");
        window.location.href = "../login.html";
      }
    </script>

    <!-- Script Progress Patroli -->
    <script>
      const maxArea = 5;
      function updatePatroliStatus() {
        const progress = JSON.parse(
          localStorage.getItem("patroliProgress") || "{}"
        );
        const now = Date.now();

        let areaNow = progress.currentArea || 1;
        let startTime = progress.startTime || now;

        // ‚úÖ Reset otomatis setelah 12 jam dari absen terakhir
        if (now - startTime > 12 * 60 * 60 * 1000) {
          localStorage.removeItem("patroliProgress");
          areaNow = 1;
          startTime = now;
          localStorage.setItem(
            "patroliProgress",
            JSON.stringify({ currentArea: areaNow, startTime })
          );
        }

        const areaDone = areaNow > 1 ? areaNow - 1 : 0;
        const progressPercent = Math.min((areaDone / maxArea) * 100, 100);

        document.getElementById("progressBar").style.width =
          progressPercent + "%";

        document.getElementById("patroliStatus").innerHTML =
          `${areaDone} dari ${maxArea} patroli dilakukan.<br>` +
          `<small>‚è≥ Progress akan direset otomatis 12 jam setelah absen terakhir.</small>`;
      }
      document.addEventListener("DOMContentLoaded", updatePatroliStatus);
    </script>

    <!-- Status Online -->
    <script>
      function updateOnlineStatus() {
        const el = document.getElementById("statusOnline");
        if (navigator.onLine) {
          el.textContent = "Online";
          el.classList.remove("offline");
          el.classList.add("online");
        } else {
          el.textContent = "Offline";
          el.classList.remove("online");
          el.classList.add("offline");
        }
      }
      updateOnlineStatus();
      window.addEventListener("online", updateOnlineStatus);
      window.addEventListener("offline", updateOnlineStatus);
    </script>

    <!-- <script src="dashboard.js"></script> -->
    <script src="../js/pending.js"></script>
  </body>
</html>
